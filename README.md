# Финансовый мониторинг и отчетность

## Описание проекта

Веб-приложение для мониторинга финансовых показателей и генерации отчетов, которое позволяет пользователям отслеживать свои доходы и расходы, а также получать аналитические отчеты на основе введенных данных.

## Архитектура приложения

Проект построен на основе Spring Boot с использованием трехуровневой архитектуры:

1. **Presentation layer** - контроллеры REST API
2. **Business logic layer** - сервисы
3. **Data access layer** - репозитории и сущности

### Технологический стек

- **Backend**: Java 17, Spring Boot 3.4.4
- **Безопасность**: Spring Security, JWT
- **База данных**: PostgreSQL, Liquibase (миграции)
- **Документация API**: Swagger/OpenAPI
- **Генерация отчетов**: Apache PDFBox
- **Маппинг объектов**: MapStruct
- **Тестирование**: JUnit 5, TestContainers
- **Сборка**: Gradle
- **Docker**: Контейнеризация приложения

## Структура проекта

```
src/
├── main/
│   ├── java/
│   │   └── com/example/globus/
│   │       ├── config/          - Конфигурации Spring
│   │       ├── controller/      - REST контроллеры
│   │       ├── dto/             - Data Transfer Objects
│   │       ├── entity/          - Сущности JPA
│   │       ├── exception/       - Обработка исключений
│   │       ├── mapstruct/       - Маппинг объектов
│   │       ├── repository/      - Репозитории JPA
│   │       ├── security/        - Настройки безопасности и JWT
│   │       ├── service/         - Бизнес-логика
│   │       └── GlobusApplication.java - Точка входа приложения
│   ├── resources/
│       ├── db/                 - Миграции Liquibase
│       ├── fonts/             - Шрифты для отчетов PDF
│       ├── application.yaml    - Конфигурация приложения
└── test/                      - Тесты
```

## Модель данных

### Основные сущности:

#### Транзакция (Transaction)
- **id** - ID транзакции
- **transactionDate** - Дата и время операции
- **personType** - Тип лица (PHYSICAL, LEGAL)
- **transactionType** - Тип транзакции (INCOME, EXPENSE)
- **amount** - Сумма операции
- **status** - Статус операции
- **bankSender** - Банк отправителя
- **bankReceiver** - Банк получателя
- **innReceiver** - ИНН получателя
- **accountReceiver** - Расчетный счет получателя
- **accountSender** - Счет отправителя
- **category** - Категория операции
- **phoneReceiver** - Телефон получателя
- **createdBy** - Пользователь, создавший операцию
- **updatedBy** - Пользователь, изменивший операцию

#### Статус транзакции (TransactionStatus)
- NEW - Новая
- CONFIRMED - Подтвержденная
- PROCESSING - В обработке
- CANCELED - Отменена
- COMPLETED - Платеж выполнен
- DELETED - Платеж удален
- REFUND - Возврат

#### Тип транзакции (TransactionType)
- INCOME - Поступление
- EXPENSE - Списание

#### Тип лица (PersonType)
- PHYSICAL - Физическое лицо
- LEGAL - Юридическое лицо

#### Банк (Bank)
- **id** - ID банка
- **name** - Название банка

#### Категория (Category)
- **id** - ID категории
- **name** - Название категории

#### Пользователь (User)
- Стандартная модель пользователя для аутентификации

## API

### Аутентификация

- **POST /auth/login** - Аутентификация пользователя

### Транзакции

- **POST /transaction** - Создание новой транзакции
- **PUT /transaction** - Обновление транзакции
- **DELETE /transaction/{id}** - Удаление транзакции
- **POST /transaction/filter** - Поиск транзакций по фильтру
- **GET /transaction/report/pdf** - Получение PDF отчета

### Банки и категории

- **GET /bank** - Получение списка банков
- **GET /category** - Получение списка категорий

## Фильтрация транзакций

Система поддерживает фильтрацию данных по следующим параметрам:
- Банк отправителя
- Банк получателя
- Дата (конкретная дата и диапазон)
- Статус операции
- ИНН
- Сумма операции (диапазон)
- Тип операции
- Категория

## Дашборды и отчеты

Система формирует следующие аналитические дашборды:
1. Динамика по количеству транзакций (неделя/месяц/квартал/год)
2. Динамика по типу транзакции (дебет/кредит)
3. Сравнение поступивших и потраченных средств
4. Количество проведенных и отмененных транзакций
5. Статистика по банкам
6. Статистический отчет по категориям доходов и расходов

## Валидация данных

- **Дата** - формат 01.01.2025
- **ИНН** - только числа, 11 цифр
- **Телефон** - маска ввода через 8 или +7 (формат ^(\\+7|8)\\d{10}$)

## Редактирование и удаление данных

### Редактирование
Запрещено редактирование операций со статусами:
- CONFIRMED (Подтвержденная)
- PROCESSING (В обработке)
- CANCELED (Отменена)
- COMPLETED (Платеж выполнен)
- DELETED (Платеж удален)
- REFUND (Возврат)

Разрешено редактирование только операций со статусом NEW.

### Удаление
Запрещено удаление операций со статусами:
- CONFIRMED (Подтвержденная)
- PROCESSING (В обработке)
- CANCELED (Отменена)
- COMPLETED (Платеж выполнен)
- REFUND (Возврат)

При удалении транзакции ее статус изменяется на DELETED.

## Запуск приложения

### Локальный запуск

```bash
./gradlew bootRun
```

### Запуск с Docker Compose

```bash
docker-compose up -d
```

## Тестирование

```bash
./gradlew test
```

## Генерация отчета о покрытии тестами

```bash
./gradlew jacocoTestReport
```